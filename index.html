<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Escape Room Timer + Locks</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #000;
      color: #fff;
      padding: 40px;
    }

    #timer {
      font-size: 60px;
      margin-bottom: 40px;
      color: white;
      transition: color 0.5s, transform 0.5s;
    }

    .lock {
      margin: 20px auto;
    }

    input[type="text"] {
      font-size: 18px;
      padding: 8px;
      width: 200px;
      text-align: center;
    }

    .correct {
      color: lime;
    }

    .clue {
      margin-top: 10px;
      color: #ffcc00;
      font-weight: bold;
      display: none;
    }

    .all-correct {
      font-size: 24px;
      color: gold;
      margin-top: 40px;
    }

    #start-screen {
      display: block;
    }

    #game-area {
      display: none;
    }

    button {
      font-size: 20px;
      padding: 12px 24px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    @keyframes pulse {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.5); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 1s ease-in-out;
    }
  </style>
</head>
<body>

  <!-- Start Screen -->
  <div id="start-screen">
    <h1>Welcome to the Escape Room</h1>
    <p>Click below to begin the challenge!</p>
    <button onclick="startGame()">Start Escape Room</button>
  </div>

  <!-- Game Area -->
  <div id="game-area">
    <h1>Escape Room Countdown</h1>
    <div id="timer">10:00</div>

    <h2>Unlock the clues:</h2>
    <div id="locks"></div>
    <div id="message" class="all-correct"></div>
  </div>

  <script>
    let time = 600; // 10 minutes in seconds
    let timerStarted = false;
    let flashInterval = null;
    let timerID = null;

    const lockData = [
      { label: "4-digit Lock #1", answer: "COPD", clue: "🧩 Clue 1: COPD CXRs." },
      { label: "3-digit Lock #2", answer: "ABC", clue: "🧩 Clue 2: COPD Questions." },
      { label: "5-digit Lock #3", answer: "CDBBB", clue: "🧩 Clue 3: MKSAP Puzzles BLUE RUL/RML/RLL and GRAY LUL/LLL." },
      { label: "4-digit Lock #4", answer: "4567", clue: "🧩 Clue 4: ECG leads reveal the rhythm." },
      { label: "5-digit Lock #5", answer: "A1B2C", clue: "🧩 Clue 5: Not all labs are normal." },
      { label: "5-digit Lock #6", answer: "Z9Y8X", clue: "🧩 Clue 6: Look inside the medication drawer." },
      { label: "3-digit Lock #7", answer: "321", clue: "🧩 Clue 7: The patient file has notes." },
      { label: "1-digit Lock #8", answer: "I", clue: "🧩 Clue 8: What's hidden in plain sight?" },
      { label: "6-digit Lock #9", answer: "CANNOT", clue: "🧩 Clue 9: Look behind the curtain." },
      { label: "7-digit Lock #10", answer: "BREATHE", clue: "🧩 Clue 10: Oxygen tank label might matter." }
    ];

    const locksContainer = document.getElementById("locks");

    function createLock(index, label, clueText) {
      const div = document.createElement("div");
      div.className = "lock";
      div.innerHTML = `
        <label for="lock${index}">${label}:</label><br>
        <input type="text" id="lock${index}" placeholder="Enter code" oninput="checkLock(${index})" autocomplete="off" />
        <span id="status${index}"></span>
        <div id="clue${index}" class="clue">${clueText}</div>
      `;
      locksContainer.appendChild(div);
    }

    function checkLock(index) {
      const input = document.getElementById(`lock${index}`);
      const status = document.getElementById(`status${index}`);
      const clue = document.getElementById(`clue${index}`);
      const correctAnswer = lockData[index].answer.trim().toUpperCase();
      const playerAnswer = input.value.trim().toUpperCase();

      if (playerAnswer === correctAnswer) {
        status.textContent = " ✅";
        status.className = "correct";
        clue.style.display = "block";
        input.disabled = true;
        checkAllSolved();
      } else {
        status.textContent = "";
      }
    }

    function checkAllSolved() {
      const allCorrect = lockData.every((lock, i) => {
        const input = document.getElementById(`lock${i}`);
        return input.value.trim().toUpperCase() === lock.answer.trim().toUpperCase();
      });

      if (allCorrect) {
        document.getElementById("message").textContent =
          "🎉 All locks unlocked! Proceed to the final puzzle.";

        clearTimeout(timerID); // Stop countdown

        const timerDisplay = document.getElementById("timer");
        const finalTime = timerDisplay.textContent; // Capture time left (MM:SS)

        // Set ESCAPED! + Time
        timerDisplay.style.color = "lime";
        timerDisplay.textContent = `ESCAPED! (${finalTime} left)`;

        // Flash for 10 seconds
        let flashCount = 0;
        const flashInterval = setInterval(() => {
          timerDisplay.style.visibility =
            timerDisplay.style.visibility === "hidden" ? "visible" : "hidden";
          flashCount++;

          if (flashCount >= 20) { // 20 * 500ms = 10 seconds
            clearInterval(flashInterval);
            timerDisplay.style.visibility = "visible"; // solid
            timerDisplay.textContent = `ESCAPED! (${finalTime} left)`;
            timerDisplay.style.color = "lime";
          }
        }, 500);
      }
    }

    function updateTimer() {
      const timerDisplay = document.getElementById("timer");

      function formatTime() {
        const minutes = Math.floor(time / 60);
        const seconds = time % 60;
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }

      function setTimerStyle() {
        if (time <= 60) {
          timerDisplay.style.color = "red";
        } else if (time <= 300) {
          timerDisplay.style.color = "yellow";
        } else {
          timerDisplay.style.color = "white";
        }
      }

      function tick() {
        timerDisplay.textContent = formatTime();
        setTimerStyle();

        // Pulse on each full minute (not 0)
        if (time % 60 === 0 && time !== 0) {
          timerDisplay.classList.add("pulse");
          setTimeout(() => {
            timerDisplay.classList.remove("pulse");
          }, 1000);
        }

        // Start flashing every 0.5s for last 10 seconds
        if (time === 10 && !flashInterval) {
          flashInterval = setInterval(() => {
            timerDisplay.style.visibility =
              timerDisplay.style.visibility === 'hidden' ? 'visible' : 'hidden';
          }, 500);
        }

        if (time === 0) {
          clearInterval(flashInterval);
          timerDisplay.style.visibility = 'visible';
          alert("⏰ Time's up!");
        } else {
          time--;
          timerID = setTimeout(tick, 1000);
        }
      }

      tick(); // begin timer loop
    }

    function startGame() {
      if (!timerStarted) {
        timerStarted = true;

        document.getElementById("start-screen").style.display = "none";
        document.getElementById("game-area").style.display = "block";

        lockData.forEach((lock, i) => createLock(i, lock.label, lock.clue));

        updateTimer();
      }
    }
  </script>
</body>
</html>


